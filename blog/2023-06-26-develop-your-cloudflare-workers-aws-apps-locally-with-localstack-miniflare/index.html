<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=/css/vendor/custom.css><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=/main.2efed5cdb92a90967e9b60d3d4adb7842678183ab3cbde086e42b1078c45aa1d0e86a3afbe9ccd468a046d1daef8eeb26717aa2664302bf271fda5534acaa030.css integrity="sha512-Lv7VzbkqkJZ+m2DT1K23hCZ4GDqzy94IbkKxB4xFqh0OhqOvvpzNRooEbR2u+O6yZxeqJmQwK/Jx/aVTSsqgMA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Develop your Cloudflare Workers + AWS apps locally with LocalStack & Miniflare - LocalStack</title><meta name=description content="In this post, we showcase how Cloudflare Workers and AWS applications can be easily tested locally, using the powerful Miniflare emulator in combination with the LocalStack platform."><link rel=canonical href=/blog/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://localstack.cloud/blog/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare/cover.png"><meta name=twitter:title content="Develop your Cloudflare Workers + AWS apps locally with LocalStack & Miniflare"><meta name=twitter:description content="In this post, we showcase how Cloudflare Workers and AWS applications can be easily tested locally, using the powerful Miniflare emulator in combination with the LocalStack platform."><meta name=twitter:site content="@localstack"><meta name=twitter:creator content="@localstack"><meta property="og:title" content="Develop your Cloudflare Workers + AWS apps locally with LocalStack & Miniflare"><meta property="og:description" content="In this post, we showcase how Cloudflare Workers and AWS applications can be easily tested locally, using the powerful Miniflare emulator in combination with the LocalStack platform."><meta property="og:type" content="article"><meta property="og:url" content="/blog/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare/"><meta property="og:image" content="/blog/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare/cover.png"><meta property="article:published_time" content="2023-06-26T00:00:00+00:00"><meta property="article:modified_time" content="2023-06-26T00:00:00+00:00"><meta property="og:site_name" content="LocalStack"><meta property="article:publisher" content="https://www.facebook.com/"><meta property="article:author" content="https://www.facebook.com/"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"\/blog\/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare\/"},"headline":"Develop your Cloudflare Workers \u002b AWS apps locally with LocalStack \u0026 Miniflare","image":["/blog/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare/cover.png","/blog/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare/diagram.png"],"datePublished":"2023-06-26T00:00:00CET","dateModified":"2023-06-26T00:00:00CET","author":{"@type":"Organization","name":"LocalStack"},"publisher":{"@type":"Organization","name":"LocalStack","logo":{"@type":"ImageObject","url":"\/\/images\/og-preview-image.png"}},"description":"In this post, we showcase how Cloudflare Workers and AWS applications can be easily tested locally, using the powerful Miniflare emulator in combination with the LocalStack platform."}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/localstack.cloud\/"},{"@type":"ListItem","position":3,"name":"Blog","item":"https:\/\/localstack.cloud\/\/blog\/"},{"@type":"ListItem","position":4,"name":"2023 06 26 Develop Your Cloudflare Workers Aws Apps Locally With Localstack Miniflare","item":"https:\/\/localstack.cloud\/\/blog\/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#6b7cf5><link rel=manifest href=/site.webmanifest><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-101988473-1','auto'),ga('send','pageview')</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-QRFTZPWGB7"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QRFTZPWGB7')</script><script defer src=https://unpkg.com/@tinybirdco/flock.js data-host=https://api.tinybird.co data-token=p.eyJ1IjogIjAwZDRjYzRjLTg4N2UtNGNmZS05YzY4LTJjNzMyNjE5ODdjMCIsICJpZCI6ICI2YzRhMDViNi1iZjVlLTRkY2QtODNlZS1jMmFjYjg5ZjQ1NzAifQ.EPdBzyAb28wUbtZacobblsMi42IwTd7d2amppDfw-jE></script><script type=text/javascript id=hs-script-loader async defer src=//js-eu1.hs-scripts.com/26596507.js></script><script type=text/javascript src=//js-eu1.hsforms.net/forms/embed/v2.js></script><script>function toggleTag(b){const c='tag-'+b;if(c!=='tag-all'){const a=document.getElementsByClassName('tag-all');for(let b=0;b<a.length;b++){const c=a[b];c.classList.add('d-none')}}const d=document.getElementsByClassName(c);for(let a=0;a<d.length;a++){const b=d[a];b.classList.remove('d-none')}const e=document.getElementsByClassName('filterButton');for(let a=0;a<e.length;a++){const b=e[a];b.classList.remove('bg-purple'),b.classList.remove('btn-primary'),b.classList.add('btn-outline-primary')}const f=b+"FilterButton",a=document.getElementById(f);a.classList.add('bg-purple'),a.classList.add('btn-primary'),a.classList.remove('btn-outline-primary')}</script></head><body class="blog single"><header class="navbar fixed-top navbar-expand-lg navbar-light pb-sm-0 bg-transparent" id=navbarGrad><div class="container pb-0 pb-sm-3"><div class="d-flex justify-content-lg-between w-100 flex-wrap flex-lg-nowrap"><label class="menu-icon order-0 d-lg-none" for=menu-btn><span class=navicon></span></label><input class="menu-btn order-0" type=checkbox id=menu-btn>
<a class="navbar-brand order-1 order-md-0" href=/><img src=/images/header-logo-new.svg height=43px alt=Logo style=margin-bottom:-10px></a><div class="flex-grow-1 order-2 d-lg-none"></div><ul class="navbar-nav social-nav d-none d-sm-flex order-3 order-lg-4"><li class=nav-item><a class="nav-link social-hover" target=_blank href=https://twitter.com/localstack><svg width="25" height="26" viewBox="0 0 25 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M25 13.25c0 6.9036-5.5964 12.5-12.5 12.5C5.59644 25.75.0 20.1536.0 13.25.0 6.34644 5.59644.75 12.5.75 19.4036.75 25 6.34644 25 13.25zm-6.56-3.0468C19.0443 10.1315 19.6205 9.97084 20.1562 9.73331 19.7558 10.3325 19.2493 10.8586 18.6651 11.2797 18.6709 11.4076 18.6738 11.5366 18.6738 11.6661c0 3.9487-3.0055 8.5014-8.5012 8.5014C8.48534 20.1675 6.91443 19.6731 5.59285 18.825 5.82615 18.8528 6.06457 18.8669 6.30522 18.8669 7.70545 18.8669 8.9936 18.3894 10.0164 17.5879 8.70861 17.5636 7.6054 16.6997 7.22527 15.5129 7.40754 15.5477 7.59449 15.5662 7.78745 15.5662 8.05952 15.5662 8.32401 15.5299 8.57447 15.4612c-1.36658-.2743-2.39692-1.4817-2.39692-2.9294C6.17755 12.5193 6.17755 12.5066 6.17777 12.4939 6.58041 12.7183 7.04144 12.8526 7.53098 12.868 6.7297 12.3323 6.20183 11.4174 6.20183 10.3811c0-.547520000000001.14751-1.06113.40465-1.50232C8.08024 10.687 10.282 11.8764 12.7651 12.001 12.7139 11.7822 12.6874 11.5542 12.6874 11.32c0-1.64975 1.338-2.98781 2.9878-2.98781.8599.0 1.6364.36276 2.1815.94322C18.5369 9.14149 19.1767 8.89304 19.754 8.55056 19.5305 9.24867 19.057 9.83358 18.44 10.2032z" fill="rgba(255, 255, 255, 0.7)"/></svg><span class=visually-hidden>Twitter</span></a></li><li class=nav-item><a class="nav-link social-hover" target=_blank href=https://github.com/localstack><svg width="25" height="26" viewBox="0 0 25 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.4984.75C5.59688.75.0 6.4882.0 13.5668c0 5.6616 3.58125 10.4647 8.55 12.161C9.175 25.8459 9.40312 25.4501 9.40312 25.1102 9.40312 24.8054 9.39219 23.9996 9.38594 22.9305 5.90938 23.7044 5.175 21.2119 5.175 21.2119c-.56719-1.4808-1.3875-1.875-1.3875-1.875C2.65156 18.5423 3.87187 18.5582 3.87187 18.5582 5.12656 18.6492 5.78594 19.8795 5.78594 19.8795c1.11562 1.9579 2.92656 1.393 3.63906 1.0643C9.5375 20.1156 9.86094 19.5507 10.2188 19.23 7.44375 18.9061 4.525 17.8066 4.525 12.8966c0-1.3994.4875-2.5436 1.2875-3.44036C5.68281 9.13231 5.25469 7.8286 5.93438 6.06534c0 0 1.05-.34468 3.43749 1.31327C10.3688 7.09457 11.4375 6.95256 12.5016 6.94777 13.5625 6.95415 14.6328 7.09457 15.6312 7.38021c2.386-1.65795 3.4344-1.31328 3.4344-1.31328.6813 1.76487.2531 3.06697.125 3.3909C19.9922 10.3546 20.475 11.4988 20.475 12.8982c0 4.9228-2.9219 6.0063-5.7063 6.3238C15.2172 19.6178 15.6172 20.3997 15.6172 21.5949 15.6172 23.3087 15.6016 24.6906 15.6016 25.1102 15.6016 25.4533 15.8266 25.8522 16.4609 25.7262 21.4219 24.0283 25 19.2268 25 13.5668 25 6.4882 19.4031.75 12.4984.75z" fill="rgba(255, 255, 255, 0.7)"/></svg><span class=visually-hidden>GitHub</span></a></li><li class=nav-item><a class="btn btn-primary btn-tertiary" type=link href=https://app.localstack.cloud><i class="bi bi-person"></i> SIGN UP</a></li></ul><div class="collapse navbar-collapse order-4 order-lg-3 flex-grow-0" id=collapse-content><ul class="navbar-nav main-nav me-auto mt-4 mt-sm-0 gap-xl-4 d-flex justify-content-between flex-column flex-sm-row"><li class="nav-item ms-0 dropdown"><a class="nav-link dropdown-toggle" href=# id=productsDropdown data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>SOLUTIONS</a><div class=dropdown-menu aria-labelledby=productsDropdown><a class=dropdown-item href=/solutions/cloud-emulation>CLOUD EMULATION</a>
<a class=dropdown-item href=/solutions/team-collaboration>TEAM COLLABORATION</a>
<a class=dropdown-item href=/solutions/enterprise-integration>ENTERPRISE INTEGRATION</a>
<a class=dropdown-item href=/solutions/ecosystem>ECOSYSTEM</a></div></li><li class="nav-item ms-0"><a class=nav-link style=white-space:nowrap href=/pricing/>PRICING</a></li><li class="nav-item ms-0 dropdown"><a class="nav-link dropdown-toggle" href=# id=productsDropdown data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>COMPANY</a><div class=dropdown-menu aria-labelledby=productsDropdown><a class=dropdown-item href=/company>ABOUT US</a>
<a class=dropdown-item href=/careers>CAREERS</a></div></li><li class="nav-item ms-0 dropdown"><a class="nav-link dropdown-toggle" href=# id=productsDropdown data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>COMMUNITY</a><div class=dropdown-menu aria-labelledby=productsDropdown><a class=dropdown-item href=/community/stay-informed>STAY INFORMED</a>
<a class=dropdown-item href=/community/get-involved>GET INVOLVED</a></div></li><li class="nav-item ms-0 active"><a class=nav-link style=white-space:nowrap href=/blog/>BLOG</a></li><li class="nav-item ms-0 dropdown"><a class="nav-link dropdown-toggle" href=# id=productsDropdown data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>DOCS</a><div class=dropdown-menu aria-labelledby=productsDropdown><a class=dropdown-item href=https://docs.localstack.cloud>DOCUMENTATION</a>
<a class=dropdown-item href=/faq>FAQ</a></div></li><li class="nav-item d-flex d-sm-none justify-content-between"><div class="d-flex gap-4"><a class=nav-link target=_blank href=https://twitter.com/localstack><svg width="25" height="26" viewBox="0 0 25 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M25 13.25c0 6.9036-5.5964 12.5-12.5 12.5C5.59644 25.75.0 20.1536.0 13.25.0 6.34644 5.59644.75 12.5.75 19.4036.75 25 6.34644 25 13.25zm-6.56-3.0468C19.0443 10.1315 19.6205 9.97084 20.1562 9.73331 19.7558 10.3325 19.2493 10.8586 18.6651 11.2797 18.6709 11.4076 18.6738 11.5366 18.6738 11.6661c0 3.9487-3.0055 8.5014-8.5012 8.5014C8.48534 20.1675 6.91443 19.6731 5.59285 18.825 5.82615 18.8528 6.06457 18.8669 6.30522 18.8669 7.70545 18.8669 8.9936 18.3894 10.0164 17.5879 8.70861 17.5636 7.6054 16.6997 7.22527 15.5129 7.40754 15.5477 7.59449 15.5662 7.78745 15.5662 8.05952 15.5662 8.32401 15.5299 8.57447 15.4612c-1.36658-.2743-2.39692-1.4817-2.39692-2.9294C6.17755 12.5193 6.17755 12.5066 6.17777 12.4939 6.58041 12.7183 7.04144 12.8526 7.53098 12.868 6.7297 12.3323 6.20183 11.4174 6.20183 10.3811c0-.547520000000001.14751-1.06113.40465-1.50232C8.08024 10.687 10.282 11.8764 12.7651 12.001 12.7139 11.7822 12.6874 11.5542 12.6874 11.32c0-1.64975 1.338-2.98781 2.9878-2.98781.8599.0 1.6364.36276 2.1815.94322C18.5369 9.14149 19.1767 8.89304 19.754 8.55056 19.5305 9.24867 19.057 9.83358 18.44 10.2032z" fill="rgba(255, 255, 255, 0.7)"/></svg><span class=visually-hidden>Twitter</span></a>
<a class=nav-link target=_blank href=https://github.com/localstack><svg width="25" height="26" viewBox="0 0 25 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.4984.75C5.59688.75.0 6.4882.0 13.5668c0 5.6616 3.58125 10.4647 8.55 12.161C9.175 25.8459 9.40312 25.4501 9.40312 25.1102 9.40312 24.8054 9.39219 23.9996 9.38594 22.9305 5.90938 23.7044 5.175 21.2119 5.175 21.2119c-.56719-1.4808-1.3875-1.875-1.3875-1.875C2.65156 18.5423 3.87187 18.5582 3.87187 18.5582 5.12656 18.6492 5.78594 19.8795 5.78594 19.8795c1.11562 1.9579 2.92656 1.393 3.63906 1.0643C9.5375 20.1156 9.86094 19.5507 10.2188 19.23 7.44375 18.9061 4.525 17.8066 4.525 12.8966c0-1.3994.4875-2.5436 1.2875-3.44036C5.68281 9.13231 5.25469 7.8286 5.93438 6.06534c0 0 1.05-.34468 3.43749 1.31327C10.3688 7.09457 11.4375 6.95256 12.5016 6.94777 13.5625 6.95415 14.6328 7.09457 15.6312 7.38021c2.386-1.65795 3.4344-1.31328 3.4344-1.31328.6813 1.76487.2531 3.06697.125 3.3909C19.9922 10.3546 20.475 11.4988 20.475 12.8982c0 4.9228-2.9219 6.0063-5.7063 6.3238C15.2172 19.6178 15.6172 20.3997 15.6172 21.5949 15.6172 23.3087 15.6016 24.6906 15.6016 25.1102 15.6016 25.4533 15.8266 25.8522 16.4609 25.7262 21.4219 24.0283 25 19.2268 25 13.5668 25 6.4882 19.4031.75 12.4984.75z" fill="rgba(255, 255, 255, 0.7)"/></svg><span class=visually-hidden>GitHub</span></a></div><a class="btn btn-primary btn-tertiary" type=link href=https://app.localstack.cloud/sign-up><i class="bi bi-person"></i> SIGN UP</a></li><li class="nav-item ms-2 d-flex d-sm-none"></li></ul></div></div></div></header><script>const myNav=document.getElementById('navbarGrad'),collapseContent=document.getElementById('collapse-content'),sm=window.matchMedia('(min-width: 576px)').matches;if(window.onscroll=function(){window.scrollY>=25?(myNav.classList.add("navbar-visible"),myNav.classList.remove("bg-transparent")):(getComputedStyle(collapseContent).display==='none'||sm)&&(myNav.classList.add("bg-transparent"),myNav.classList.remove("navbar-visible"))},!sm){const a=document.getElementById('menu-btn');a.onclick=function(){myNav.classList.contains('bg-transparent')?(myNav.classList.add("navbar-visible"),myNav.classList.remove("bg-transparent")):window.scrollY===0&&(myNav.classList.add("bg-transparent"),myNav.classList.remove("navbar-visible"))}}$(document).ready(function(){$(".dropdown").hover(function(){var a=$(this).children(".dropdown-menu");a.is(":visible")&&a.parent().toggleClass("open")})})</script><style>.social-hover:hover svg path{fill:#fff}.dropdown:hover .dropdown-menu{display:block}.dropdown-menu{margin-top:.125rem}</style><section class="section section-sm bg-gradient-dark"><div class="position-absolute w-100 section pb-7 pt-7 d-none d-md-block"><div class=container><div class="row justify-content-center align-items-center"><div class=col-2><img class=w-100 style=transform:scale(2);opacity:.65 src=/images/heroes/blog.svg></div><div class=col-2></div><div class=col-2></div><div class=col-2><img class=w-100 style=transform:rotate(35deg)scale(1.4);opacity:.9 src=/images/heroes/blog.svg></div><div class=col-2><img class=w-100 style=transform:rotate(-45deg)scaleX(-1)scale(1.5);opacity:.75 src=/images/heroes/blog.svg></div></div></div></div><div class="container pb-5 pt-6 pb-md-7 pt-sm-7"><div class="row justify-content-center align-items-center text-white"><h1 class="text-center m-0 pt-lg-5">Develop your Cloudflare Workers + AWS apps locally with LocalStack & Miniflare</h1></div></div></section><section class="section section-sm mb-6"><div class="container px-lg-8"><div class="row justify-content-center"><div class=col-12><article><div class=blog-header><div class="d-flex align-items-center flex-wrap card-footer-text"><p class=mb-0><img src=/images/common/clock.svg>
8&nbsp;MIN READ&nbsp;&#8212;&nbsp;
posted June 26, 2023 by <a class="stretched-link position-relative">Adam Murray</a> and <a class="stretched-link position-relative">Brendan Coll</a> and <a class="stretched-link position-relative">Harsh Mishra</a> and <a class="stretched-link position-relative">Waldemar Hummer</a></p><p></div></div><p class=lead>In this post, we showcase how Cloudflare Workers and AWS applications can be easily tested locally, using the powerful Miniflare emulator in combination with the LocalStack platform.</p><img class="img-simple img-fluid lazyload blur-up" src=/blog/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare/cover_hu1b73f1846d938cb4b083a9ae560d7c37_3180852_20x0_resize_box_2.png data-src=/blog/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare/cover.png width=3840 height=2160 alt="Cover image for the `Develop your Cloudflare Workers + AWS apps locally with LocalStack & Miniflare` blog"><p>LocalStack is a cloud development platform that turbocharges your cloud application development & testing, fosters team collaboration, and provides an integrated cloud developer experience with a local cloud sandbox. <a href=https://github.com/localstack/localstack>LocalStack’s core cloud emulator</a> runs inside a Docker container and provides a set of external network ports for <a href=https://docs.localstack.cloud/user-guide/integrations/>integrations</a>, <a href=https://docs.localstack.cloud/user-guide/integrations/sdks/>SDKs</a>, or <a href=https://docs.localstack.cloud/user-guide/ci/>CI providers</a> for developers to execute their cloud & serverless applications fully locally without talking to the real cloud services. This enables a highly efficient development loop, by reducing the feedback cycles from minutes to seconds.</p><p>LocalStack has traditionally been popular among cloud developers for its extensive set of AWS services, such as <a href=https://docs.localstack.cloud/user-guide/aws/dynamodb/>DynamoDB</a>, <a href=https://docs.localstack.cloud/user-guide/aws/s3/>S3</a>, <a href=https://docs.localstack.cloud/user-guide/aws/elastic-kubernetes-service/>EKS</a>, and more, and for its comprehensive feature set, like <a href=https://docs.localstack.cloud/user-guide/tools/lambda-tools/hot-reloading/>hot reloading for Lambda</a> & <a href=https://docs.localstack.cloud/user-guide/tools/cloud-pods/>Cloud Pods</a>, that provides a frictionless development experience.</p><p>With the <a href=https://localstack.cloud/blog/2022-07-13-announcing-localstack-v1-general-availability/>LocalStack 1.0 release</a>, we introduced <a href=https://localstack.cloud/blog/2022-09-12-announcing-localstack-extensions/>LocalStack Extensions</a>. Extensions allow users to extend and customize LocalStack using pluggable Python distributions. The Extensions API allows developers to easily plug in their own custom logic and services into the LocalStack container.</p><p>With LocalStack Extensions, it is now possible to start custom services with LocalStack in the same container, while leveraging the existing features in the ecosystem. Developers can add new services, extend existing services, and even add custom functionality that goes beyond the scope of AWS cloud emulation - in particular, it can encompass other cloud providers, like Cloudflare!</p><h2 id=what-are-cloudflare-workers--miniflare>What are Cloudflare Workers & Miniflare?</h2><p><a href=https://www.cloudflare.com/>Cloudflare</a> is an internet service provider focused on providing content delivery network (CDN) and web security services. One of the key features in their service offering is <a href=https://workers.cloudflare.com>Cloudflare Workers</a>, a platform to run JavaScript service workers at the Edge. It allows users to inject functionality like setting user cookies, performing web redirects, modifying served content via search/replace, rewriting URLs, etc.</p><p>The Cloudflare team has released a high-fidelity local emulator called <em>Miniflare</em> that allows users to run the JavaScript code of Cloudflare Workers locally. Cloudflare recently announced the release of <a href=https://blog.cloudflare.com/wrangler3/>Miniflare v3</a> during their Developer Week in May 2023. Miniflare v3, now based on the <code>workerd</code> runtime, offers several new features and enhancements, providing even higher parity with the real environment. This is a major step towards providing a <em>local-first</em> developer experience for Clouflare users, and is a perfect match for LocalStack&rsquo;s vision of giving developers back control over their local dev cycles.</p><h2 id=a-sample-application-using-cloudflare-workers--aws>A sample application using Cloudflare Workers + AWS</h2><p>Consider an illustrative sample of a Cloudflare Workers application that connects to the AWS Simple Queueing Service (SQS) to publish incoming messages to a queue. The sample is adapted from the <a href=https://github.com/cloudflare/workers-sdk/tree/main/templates/worker-aws>Cloudflare examples repository</a>, and the essential parts are summarized below (the complete source code of the sample is available in <a href=https://github.com/localstack/localstack-extensions/tree/main/miniflare/example-aws>this repository</a>).</p><p>First, we define some imports and create the main fetch event listener for the Worker:</p><pre><code class=language-js>import { SQSClient, SendMessageCommand } from '@aws-sdk/client-sqs';

export default {
  async fetch(request) {
    return handleRequest(request);
  }
};
</code></pre><p>In the request handler below, we call a sendSqsMessage function, receive the result, and simply return the result back to the caller.</p><pre><code class=language-js>async function handleRequest() {
   const result = await sendSqsMessage();
   return new Response(JSON.stringify(result), {
      headers: { 'content-type': 'application/json' },
   });
}
</code></pre><p>To allow the Worker to access an SQS resource, we first need to configure the credentials and region of the AWS SDK client - note that the code snippet below uses the global variables <code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>, and <code>AWS_REGION</code> which are later defined as secrets and are automatically injected into the environment.</p><pre><code class=language-js>const myCredentialProvider = () =&gt; ({
   // use wrangler secrets to provide these variables (see further below)
   accessKeyId: AWS_ACCESS_KEY_ID,
   secretAccessKey: AWS_SECRET_ACCESS_KEY,
});


const clientParams = {
  region: AWS_REGION,
  credentialDefaultProvider: myCredentialProvider,
};
</code></pre><p>The main business logic is happening in the sendSqsMessage function below: we first create an SQS client using the AWS JavaScript SDK, and we then create a <code>SendMessageCommand</code> request object and call the send API to send the message to SQS. Note that the SQS queue URL is retrieved from an environment variable <code>AWS_SQS_QUEUE_URL</code> which we’ll define further below.</p><pre><code class=language-js>async function sendSqsMessage() {
   const client = new SQSClient(clientParams);
   const send = new SendMessageCommand({
      // use wrangler secrets to provide this global variable
      QueueUrl: AWS_SQS_QUEUE_URL,
      MessageBody: 'Hello SQS from a Cloudflare Worker',
   });
   return client.send(send);
}
</code></pre><p>Ok, so how can we now test this Cloudflare Workers + AWS application locally? In the following sections, we illustrate how it all comes together.</p><h2 id=extending-miniflare-with-localstacks-cloudflare-extension>Extending Miniflare with LocalStack’s Cloudflare Extension</h2><p>Combining Miniflare’s capability with LocalStack’s cloud sandbox, which can be spun up as a Docker container, helps developers to get up and running with Workers development within a few seconds. This is particularly interesting for Cloudflare applications that are connecting to AWS services and resources, such as S3 buckets, SQS queues, DynamoDB tables, or various others.</p><p>The figure below illustrates how Miniflare is embedded as an Extension into the LocalStack platform. Once enabled, the LocalStack Cloudflare Extension exposes an additional endpoint at <code>http://localhost:4566/miniflare</code> which provides an emulated version of the Cloudflare API, allowing users to create local services, script uploads, deployments — while additionally leveraging the full power of the LocalStack AWS emulator.</p><img class="img-simple img-fluid lazyload blur-up" src=/blog/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare/diagram_hu07a64bc343dec23408cbd239621904fe_647127_20x0_resize_box_2.png data-src=/blog/2023-06-26-develop-your-cloudflare-workers-aws-apps-locally-with-localstack-miniflare/diagram.png width=3840 height=2160 alt="Cover image of how Miniflare is embedded as an Extension into the LocalStack platform"><p>You can operate LocalStack’s Cloudflare extension via the <code>wrangler</code> CLI as the extension receives the deployment requests under the <code>/cloudflare/…</code> endpoint. Internally, the <code>miniflare</code>/<code>wrangler</code> process is started inside the LocalStack container and is accessible under a new local endpoint like <code>w1.cloudflare.localhost.localstack.cloud</code>. The client can use this endpoint to invoke the deployed Worker via the Web browser or an HTTP client like <code>cURL</code>.</p><h2 id=testing-our-sample-application-using-the-localstack-cloudflare-extension>Testing our sample application using the LocalStack Cloudflare Extension</h2><p>To test and run our sample application locally, we are adding a small change to the <code>clientParams</code> object above with a switch for local development: if the <code>ENV</code> is set to <code>dev</code>, then we set the AWS SDK endpoint to use the LocalStack APIs on <code>localhost:4566</code>.</p><pre><code class=language-js>const clientParams = {...};
if (ENV === “dev”) {
  // define LocalStack endpoint for local testing
  clientParams.endpoint = &quot;http://localhost:4566&quot;;
}
</code></pre><p>In the following, we describe the detailed installation steps to run the sample application locally.</p><h3 id=install-localstack-cloudflare-extension>Install LocalStack Cloudflare Extension</h3><p>To install the LocalStack Cloudflare Extension, we first install the <code>localstack</code> CLI on your development machine. To use Extensions with LocalStack, you must have an API key configured (you can <a href=https://app.localstack.cloud/>sign-up for a free trial</a> to get your API key). Before installing the Extension, log in to your LocalStack account using your username and password:</p><pre><code class=language-sh>$ localstack login
Please provide your login credentials below
Username: …
Password: …
</code></pre><p>After logging in into your LocalSack account, install the Extension using the following command:</p><pre><code class=language-sh>$ localstack extensions install &quot;git+https://github.com/localstack/localstack-extensions/#egg=localstack-extension-miniflare&amp;subdirectory=miniflare&quot;
</code></pre><p>After the installation of the LocalStack Cloudflare Extension, you can start the LocalStack container with your API key configured. Run the following command:</p><pre><code class=language-sh>$ export LOCALSTACK_API_KEY=XXX
$ localstack start -d
</code></pre><h3 id=set-up-the-wrangler-application-with-localstack>Set up the Wrangler application with LocalStack</h3><p>To use the extension, we can simply use the <a href=https://github.com/cloudflare/workers-sdk><code>wrangler</code></a> CLI after exporting the relevant environment variables <code>CLOUDFLARE_API_BASE_URL</code> and <code>CLOUDFLARE_API_TOKEN</code>, which cause wrangler to run the deployment requests against the LocalStack Cloudflare Extension. Let us set the following environment variables for local development:</p><pre><code class=language-sh>$ export AWS_DEFAULT_REGION=us-east-1
$ export CLOUDFLARE_API_TOKEN=test
$ export CLOUDFLARE_API_BASE_URL=http://localhost:4566/miniflare 
$ wrangler init
</code></pre><p>Next, we create an SQS queue locally in LocalStack, using the <a href=https://github.com/localstack/awscli-local><code>awslocal</code></a> command line interface (note that we’re extracting the queue URL from the output and assign it to the <code>queueUrl</code> variable):</p><pre><code class=language-sh>$ queueUrl=$(awslocal sqs create-queue --queue-name q1 | jq -r .QueueUrl) 
</code></pre><p>We can now use wrangler to define the secrets, which will be automatically injected as environment variables in our script above. In the shell commands below, we are setting the values for the AWS credentials, the SQS queue URL, as well as the <code>ENV=dev</code> switch for local development.</p><pre><code class=language-sh>$ echo &quot;test&quot; | wrangler secret put AWS_ACCESS_KEY_ID
$ echo &quot;test&quot; | wrangler secret put AWS_SECRET_ACCESS_KEY
$ echo &quot;$queueUrl&quot; | wrangler secret put AWS_SQS_QUEUE_URL
$ echo &quot;dev&quot; | wrangler secret put ENV
</code></pre><p>Now that everything is set up and configured, we can trigger the local deployment of our Worker application via the <code>wrangler publish</code> command:</p><pre><code class=language-sh>$ wrangler publish
</code></pre><p>After a successful deployment, the local Cloudflare worker can be easily invoked via <code>cURL</code> - note that the <code>*.miniflare.localhost.localstack.cloud</code> DNS name resolves to a local IP address (<code>127.0.0.1</code>):</p><pre><code class=language-sh>$ curl http://worker-aws.miniflare.localhost.localstack.cloud:4566/test
{
        &quot;Messages&quot;: [{
                &quot;MessageId&quot;: &quot;f76db8be-9cc8-47da-8918-9df686169712&quot;,
                &quot;ReceiptHandle&quot;: &quot;NGUwNDg3NTM…&quot;,
                &quot;MD5OfBody&quot;: &quot;58d3b165…&quot;,
                &quot;Body&quot;: &quot;Hello SQS from a Cloudflare Worker&quot;
        }]
}
</code></pre><p>Congratulations! 🎉 If you see the output above, then the end-to-end roundtrip of invoking our Cloudflare Worker + AWS application has completed successfully. It is worth noting that <strong>no</strong> cloud credentials whatsoever are required to run this sample, hence we are also not incurring any costs during development. Once the application is ready to deploy to production, we can easily make the switch and point <code>wrangler</code> to the real Cloudflare environment (by adjusting the environment secrets accordingly).</p><h2 id=conclusion>Conclusion</h2><p>With LocalStack Extensions, you can now leverage an end-to-end local development cycle for your Worker apps that empowers you to build, test, and deploy your applications reliably and efficiently. The LocalStack Cloudflare Extension allows you to create a locally reproducible environment that can be easily integrated into your CI/CD pipeline and execute integration tests and your production environment seamlessly. In addition, with your applications running in a sandbox environment, you will not incur significant costs while isolated from real cloud resources.</p><p>At LocalStack, we continue to invest in our Extensions mechanism and provide emulators that go beyond our core scope of running AWS apps locally — aiming to become the go-to platform for running emulators for any API or managed service out there! We would love to hear your thoughts and whether you have ideas for new LocalStack Extensions we could develop. Join our <a href=https://discuss.localstack.cloud/>Discuss Forum</a> to get started and share your feedback and suggestions 🚀</p><p>If you have questions about configuring and running your project, drop by <a href=https://discord.com/invite/cloudflaredev>Cloudflare’s Community Discord server</a> or the <a href=https://localstack.cloud/slack/>LocalStack Slack Community</a>!</p></article></div></div></div></section><section class="section bg-gradient-light"><div class=container><div class="row justify-content-center"><div class="d-flex flex-column gap-4 col-lg-12 text-white"><h2 class="h2 text-center">Stay in the loop</h2><p>We'd love to get in touch with you.
Please subscribe with your email to stay tuned for release notes and product updates.
We promise never to send an excessive amount of emails (we hate spam, too).</p><script>hbspt.forms.create({region:"eu1",portalId:"26596507",formId:"1cc99237-4ce0-4d65-abdf-f87ac2724717"})</script></div></div></div></section><footer class="footer pt-6 bg-gradient-dark"><div class="footer-main pb-5"><div class=container><div class="row justify-content-between"><div class="col-12 col-lg-4"><img style=width:243px src=/images/header-logo-new.svg alt="LocalStack Logo"></div><div class="col-12 col-lg-8 mt-4 mt-lg-0"><div class="row gap-4"><div class=col><ul class="list-unstyled gap-4 d-flex flex-column"><li><a class=footer-text href=/contact>Contact</a></li><li><a class=footer-text href=/pricing>Pricing</a></li><li><a class=footer-text href=/blog>Blog</a></li><li><a class=footer-text href=/careers>Careers</a></li></ul></div><div class=col><ul class="list-unstyled gap-4 d-flex flex-column"><li><a class=footer-text href=https://app.localstack.cloud>App</a></li><li><a class=footer-text href=/community>Community</a></li><li><a class=footer-text href=/faq>FAQ</a></li></ul></div><div class=col><ul class="list-unstyled gap-4 d-flex flex-column"><li><a class=footer-text href=https://github.com/localstack>GitHub</a></li><li><a class=footer-text href=https://hub.docker.com/u/localstack>DockerHub</a></li><li><a class=footer-text href=https://docs.localstack.cloud>Docs</a></li></ul></div><div class=col><ul class="list-unstyled gap-4 d-flex flex-column"><li class=footer-text>Follow us</li><li class="d-flex gap-3"><a class=footer-text href=https://twitter.com/localstack><span><svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M25 13.25c0 6.9036-5.5964 12.5-12.5 12.5C5.59644 25.75.0 20.1536.0 13.25.0 6.34644 5.59644.75 12.5.75 19.4036.75 25 6.34644 25 13.25zm-6.56-3.0468C19.0443 10.1315 19.6205 9.97084 20.1562 9.73331 19.7558 10.3325 19.2493 10.8586 18.6651 11.2797 18.6709 11.4076 18.6738 11.5366 18.6738 11.6661c0 3.9487-3.0055 8.5014-8.5012 8.5014C8.48534 20.1675 6.91443 19.6731 5.59285 18.825 5.82615 18.8528 6.06457 18.8669 6.30522 18.8669 7.70545 18.8669 8.9936 18.3894 10.0164 17.5879 8.70861 17.5636 7.6054 16.6997 7.22527 15.5129 7.40754 15.5477 7.59449 15.5662 7.78745 15.5662 8.05952 15.5662 8.32401 15.5299 8.57447 15.4612c-1.36658-.2743-2.39692-1.4817-2.39692-2.9294C6.17755 12.5193 6.17755 12.5066 6.17777 12.4939 6.58041 12.7183 7.04144 12.8526 7.53098 12.868 6.7297 12.3323 6.20183 11.4174 6.20183 10.3811c0-.547520000000001.14751-1.06113.40465-1.50232C8.08024 10.687 10.282 11.8764 12.7651 12.001 12.7139 11.7822 12.6874 11.5542 12.6874 11.32c0-1.64975 1.338-2.98781 2.9878-2.98781.8599.0 1.6364.36276 2.1815.94322C18.5369 9.14149 19.1767 8.89304 19.754 8.55056 19.5305 9.24867 19.057 9.83358 18.44 10.2032z" fill="#fff"/></svg></span></a><a class=footer-text href=https://www.linkedin.com/company/localstack-cloud><span><svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 26c7.1797.0 13-5.8203 13-13S20.1797.0 13 0 0 5.8203.0 13 5.8203 26 13 26zM9.35126 10.5024C9.97963 10.5024 10.489 9.993 10.489 9.36463S9.97963 8.22687 9.35126 8.22687 8.2135 8.73626 8.2135 9.36463s.50939 1.13777 1.13776 1.13777zm2.21194.8622v6.3122h1.9599V14.5553C13.5231 13.7316 13.6781 12.9339 14.6993 12.9339c1.0073.0 1.0198.941700000000001 1.0198 1.6734v3.0701H17.68V14.2157C17.68 12.5153 17.3139 11.2086 15.3265 11.2086c-.9542.0-1.5938.5236-1.8554 1.0192H13.4446V11.3646H11.5632zm-3.19382.0H10.3324v6.3122H8.36938V11.3646z" fill="#fff"/></svg></span></a></li></ul></div></div></div></div></div></div><div class=footer-bottom><div class="container mb-2"><hr><div class="row pt-4"><div class=col style=color:#fff;opacity:.5>Copyright &copy; LocalStack</div><div class="col text-end"><ul class=list-inline><li class=list-inline-item><a class=footer-last-text href=/privacy-policy>Privacy policy</a></li><li class=list-inline-item><a class=footer-last-text href=/terms>Terms of Service</a></li><li class=list-inline-item><a class=footer-last-text href=/#>Imprint</a></li></ul></div></div></div></div></footer><script src=/js/bootstrap.min.51b4083a09e54138d5bbe9c42a5f5f71af6e60a417f276d5620cbde3b15eb1a07c9ea17a889bc58074adf9b19641039a77521d3131f039300d2fe29ffa532aa8.js integrity="sha512-UbQIOgnlQTjVu+nEKl9fca9uYKQX8nbVYgy947FesaB8nqF6iJvFgHSt+bGWQQOad1IdMTHwOTANL+Kf+lMqqA==" crossorigin=anonymous defer></script><script src=/js/highlight.min.8cdbefd08ec63ef25f4b2510ae50c13b3d9ed43e25a15ddb55f14c33130e68cf8be3131ccf2d087c49f5f21fe88c2f0e2715a21f936047d0d0b85dc48cb864b9.js integrity="sha512-jNvv0I7GPvJfSyUQrlDBOz2e1D4loV3bVfFMMxMOaM+L4xMczy0IfEn18h/ojC8OJxWiH5NgR9DQuF3EjLhkuQ==" crossorigin=anonymous defer></script><script src=/main.min.8933efb6bcdc37606a11f732d52c6f65d7fc1d082b89d56516f6a1bfb528ee7c40c3430bb80214cdd129ec7d69d4cadd74e693da54a9ba6f08c44771204d4468.js integrity="sha512-iTPvtrzcN2BqEfcy1SxvZdf8HQgridVlFvahv7Uo7nxAw0MLuAIUzdEp7H1p1MrddOaT2lSpum8IxEdxIE1EaA==" crossorigin=anonymous defer></script><script src=/index.min.28297aad85d5f5902201eb4ef84e7012a37d4a34824e2256df80cd91e547bf155df22029e5596951d6f2692dd1fee54c76721b407e5ac526bd33bedc636a87e5.js integrity="sha512-KCl6rYXV9ZAiAetO+E5wEqN9SjSCTiJW34DNkeVHvxVd8iAp5VlpUdbyaS3R/uVMdnIbQH5axSa9M77cY2qH5Q==" crossorigin=anonymous defer></script></body></html>